pluginManagement {
    // Flutter SDK 경로를 동적으로 감지 (Windows/Mac 호환)
    def localPropertiesFile = file("local.properties")
    def properties = new Properties()
    
    // local.properties에서 flutter.sdk 읽기 시도
    def flutterSdkPath = null
    if (localPropertiesFile.exists()) {
        try {
            localPropertiesFile.withInputStream { 
                properties.load(it) 
            }
            flutterSdkPath = properties.getProperty("flutter.sdk")
        } catch (Exception e) {
            println "Warning: Could not read local.properties: ${e.message}"
        }
    }
    
    // 환경변수에서 읽기 시도
    if (flutterSdkPath == null || flutterSdkPath.isEmpty()) {
        flutterSdkPath = System.env.FLUTTER_ROOT
    }
    
    // Flutter 명령어로부터 경로 감지 시도
    if (flutterSdkPath == null || flutterSdkPath.isEmpty()) {
        try {
            def isWindows = System.properties['os.name'].toLowerCase().contains('windows')
            def flutterCommand = isWindows ? 'where flutter' : 'which flutter'
            def process = flutterCommand.execute()
            process.waitFor()
            if (process.exitValue() == 0) {
                def flutterBin = process.text.trim().split('\n')[0]
                def flutterBinFile = new File(flutterBin)
                if (flutterBinFile.exists()) {
                    // bin/flutter -> Flutter SDK root
                    flutterSdkPath = flutterBinFile.getParentFile().getParent()
                }
            }
        } catch (Exception e) {
            println "Warning: Could not auto-detect Flutter SDK path: ${e.message}"
        }
    }
    
    if (flutterSdkPath == null || flutterSdkPath.isEmpty()) {
        throw new GradleException(
            "Flutter SDK not found. Define flutter.sdk in local.properties or set FLUTTER_ROOT environment variable."
        )
    }
    
    println "=== Flutter SDK Path: $flutterSdkPath ==="
    
    includeBuild("$flutterSdkPath/packages/flutter_tools/gradle")

    repositories {
        google()
        mavenCentral()
        gradlePluginPortal()
    }
}

plugins {
    id "dev.flutter.flutter-plugin-loader" version "1.0.0"
    id "com.android.application" version "8.6.0" apply false
    // START: FlutterFire Configuration
    id "com.google.gms.google-services" version "4.3.15" apply false
    // END: FlutterFire Configuration
    id "org.jetbrains.kotlin.android" version "2.1.0" apply false
}

include ":app"